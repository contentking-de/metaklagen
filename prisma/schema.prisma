// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Mandate {
  id                            String        @id @default(cuid())
  vorname                       String
  nachname                      String
  email                         String
  telefon                       String?
  adresse                       String
  plz                           String
  wohnort                       String
  geburtsdatum                  DateTime
  instagramAccountDatum         DateTime?
  facebookAccountDatum          DateTime?
  versicherer                   String?
  versicherungsnummer           String?
  versicherungsAbschlussdatum   DateTime?
  versicherungsnehmer           String?
  versicherungsnehmerVerhaeltnis String?
  status                        MandateStatus @default(NEU)
  pandadocDocumentId            String?
  pandadocSessionId              String?
  signedVollmachtUrl             String?
  vollmachtSignedAt              DateTime?
  partnerId                      String?
  referrer                      String?
  createdAt                     DateTime      @default(now())
  updatedAt                     DateTime      @updatedAt
  partner                       Partner?      @relation(fields: [partnerId], references: [id], onDelete: SetNull)

  @@map("mandates")
}

model AdminUser {
  id           String   @id @default(cuid())
  email        String   @unique
  passwordHash String   @map("password_hash")
  name         String?
  createdAt    DateTime @default(now())

  @@map("admin_users")
}

model Partner {
  id          String    @id @default(cuid())
  name        String
  trackingId  String    @unique
  email       String?   @unique
  active      Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  mandates    Mandate[]
  tokens      PartnerToken[]

  @@map("partners")
}

model PartnerToken {
  id        String   @id @default(cuid())
  token     String   @unique
  partnerId String
  expiresAt DateTime
  used      Boolean  @default(false)
  createdAt DateTime @default(now())
  partner   Partner  @relation(fields: [partnerId], references: [id], onDelete: Cascade)

  @@map("partner_tokens")
  @@index([token])
  @@index([partnerId])
}

enum MandateStatus {
  NEU
  IN_BEARBEITUNG
  ABGESCHLOSSEN
  ABGELEHNT
}
